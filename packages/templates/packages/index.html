{% extends 'base.html' %}

{% block extraheaders %}
<title>Twine Package Manager - Packages</title>
<meta
    name="description"
    content="Explore new packages and search the database."
>
{% endblock %}

{% block content %}
<article class="container">
    <h1>Packages</h1>
    <h5>
        <a href="/packages/create/">Create new package</a>
    </h5>

    <label for="packages-ordering-field">
        Order by:
    </label>

    <select id="packages-ordering-field" class="packages-ordering-field">
        <option value="downloads"{% if not ordering_field or ordering_field == 'downloads' %} selected{% endif %}>
            Downloads
        </option>

        <option value="id"{% if ordering_field == 'id' %} selected{% endif %}>
            ID
        </option>

        <option value="date_modified"{% if ordering_field == 'date_modified' %} selected{% endif %}>
            Date last modified
        </option>

        <option value="date_created"{% if ordering_field == 'date_created' %} selected{% endif %}>
            Date created
        </option>
    </select>

    <label for="packages-ordering-direction">
        Order direction:
    </label>

    <select id="packages-ordering-direction" class="packages-ordering-direction">
        <option value="ascending"{% if ordering_direction == 'ascending' %} selected{% endif %}>
            Ascending
        </option>

        <option value="descending"{% if not ordering_direction or ordering_direction == 'descending' %} selected{% endif %}>
            Descending
        </option>
    </select>

    <button class="packages-update">
        Update
    </button>

    <ul>
        {% for package in results %}
            {% include 'packages/package.html' %}
        {% empty %}
            No packages exist yet.
        {% endfor %}
    </ul>

    {% if previous_url %}
        <a href="{{ previous_url }}">Previous</a>
    {% endif %}

    {% if next_url %}
        <a href="{{ next_url }}">Next</a>
    {% endif %}
</article>

<script>
(function () {
    var orderingField = document.querySelector('.packages-ordering-field');
    var orderingDirection = document.querySelector('.packages-ordering-direction');
    var updateButton = document.querySelector('.packages-update');
    var offset = (location.href.match(/\/[^/]+(offset=\d+)/) || [])[1];
    updateButton.addEventListener('click', function () {
        var direction = orderingDirection.value === 'ascending' ? '' : '-'; 
        var pathname = '/packages/?' +
            'ordering=' + direction + orderingField.value;

        if (offset) {
            pathname += '&' + offset;
        }

        location.href = pathname;
    });
})();
</script>
{% endblock %}